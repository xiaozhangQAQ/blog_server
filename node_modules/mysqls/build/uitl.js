"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof2=require("babel-runtime/helpers/typeof"),_typeof3=_interopRequireDefault(_typeof2),_keys=require("babel-runtime/core-js/object/keys"),_keys2=_interopRequireDefault(_keys);exports.getOptToString=getOptToString,exports.checkOptType=checkOptType,exports.checkOptObjType=checkOptObjType,exports.expressionQuery=expressionQuery,exports.sortSelectSql=sortSelectSql,exports.handleInsertData=handleInsertData;var _sqlstring=require("sqlstring"),_sqlstring2=_interopRequireDefault(_sqlstring);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getOptToString(n){var o="",e=Object.prototype.toString.call(n);if("[object Object]"===e){var r=n._type&&n._type.toUpperCase()||"AND",c=n._type&&n._type.trim()?1:0,a=(0,_keys2.default)(n);a.forEach(function(e,t){"_type"!==e&&(o="object"===(0,_typeof3.default)(n[e])?t===a.length-1-c?o+""+checkOptObjType(e,n[e]):o+(checkOptObjType(e,n[e])+" ")+r+" ":t===a.length-1-c?o+(e+"=")+checkOptType(n[e]):o+(e+"=")+checkOptType(n[e])+" "+r+" ")})}else"[object Array]"===e&&n.forEach(function(r,e){var c="",t=0,a=r._type&&r._type.toUpperCase()||"AND",p=r._nexttype||"AND";t=r._type&&r._type.trim()?t+1:t,t=r._nexttype&&r._nexttype.trim()?t+1:t,(0,_keys2.default)(r).forEach(function(e,t){"_type"!==e&&"_nexttype"!==e&&(c=c?"object"===(0,_typeof3.default)(r[e])?c+(a+" ")+checkOptObjType(e,r[e]):c+(a+" ")+e+"="+checkOptType(r[e])+" ":"object"===(0,_typeof3.default)(r[e])?""+checkOptObjType(e,r[e]):e+"="+checkOptType(r[e])+" ")}),c=e===n.length-1?"("+c+")":"("+c+") "+p.toUpperCase(),o=o+" "+c});return o}function checkOptType(e,t,r,c){var a=void 0;switch(Object.prototype.toString.call(e)){case"[object String]":e=e.trim(),e=_sqlstring2.default.escape(e),a=r&&c&&-1<e.indexOf(t)&&e.match(/\+|-|\*|\/|%/)?e.slice(1,-1):""+e;break;case"[object Boolean]":case"[object Number]":a=e;break;default:a=_sqlstring2.default.escape(e)}return a}function checkOptObjType(c,a){var p="";if("[object Object]"===Object.prototype.toString.call(a)){var n=(0,_keys2.default)(a),o=a._type&&a._type.trim()?1:0;n.forEach(function(e,t){if("_type"!==e){var r=a._type||"AND";p+=expressionQuery(c,e,a[e],r.toUpperCase(),t===n.length-1-o)}})}else p=c+"="+a;return"("+p+") "}function expressionQuery(e,t,r,c,a){var p="";switch(t.toUpperCase()){case"EQ":p="("+e+"="+checkOptType(r)+")";break;case"NEQ":p="("+e+"<>"+checkOptType(r)+")";break;case"GT":p="("+e+">"+checkOptType(r)+")";break;case"EGT":p="("+e+">="+checkOptType(r)+")";break;case"LT":p="("+e+"<"+checkOptType(r)+")";break;case"ELT":p="("+e+"<="+checkOptType(r)+")";break;case"LIKE":p="("+e+" LIKE "+checkOptType(r)+")";break;case"NOTLIKE":p="("+e+" NOT LIKE "+checkOptType(r)+")";break;case"BETWEEN":p="("+e+" BETWEEN "+r.replace(","," AND ")+")";break;case"NOTBETWEEN":p="("+e+" NOT BETWEEN "+r.replace(","," AND ")+")";break;case"IN":p="("+e+" IN ("+r+"))";break;case"NOTIN":p="("+e+" NOT IN ("+r+"))";break;default:p="("+e+"="+checkOptType(r)+")"}return a?p+" ":p+" "+c+" "}function sortSelectSql(e){var t=e||{};if(t.count||t.max||t.min||t.avg||t.sum){var r=(t.count?","+t.count:"")+(t.max?","+t.max:"")+(t.min?","+t.min:"")+(t.avg?","+t.avg:"")+(t.sum?","+t.sum:"");t.count=t.max=t.min=t.avg=t.sum="",t.field?t.field=t.field+r:t.field=r.substring(1)}t.field||(t.field="*"),t.table&&(t.table="FROM "+t.table),t.where&&(t.where="WHERE "+t.where);var c=(0,_keys2.default)(t),a=[],p=["union","distinct","field","count","max","min","avg","sum","table","alias","where","group","having","order","limit","page","comment"];return c.forEach(function(r,e){p.forEach(function(e,t){r===e&&(a[t]=r)})}),{sortkeys:a,result:t}}function sortArray(e){for(var t=[],r=(0,_keys2.default)(e[0]),c=1;c<e.length;c++)for(var a=0;a<r.length;a++)(0,_keys2.default)(e[c]).includes(r[a])||r.splice(a,1);for(var p=0;p<e.length;p++){for(var n={},o=0;o<r.length;o++)n[[r[o]]]=e[p][r[o]];t.push(n)}return t}function handleInsertData(e){if(!e)return"";Array.isArray(e)&&1===e.length&&(e=e[0]);var t="",r="";if(Array.isArray(e)){e=sortArray(e),t=(0,_keys2.default)(e[0]).toString();for(var c=0;c<e.length;c++){var a="";for(var p in e[c])a=a?a+","+checkOptType(e[c][p]):checkOptType(e[c][p]);r+="("+a+"),"}r=r.slice(0,-1)}else{for(var n in e)t=t?t+","+n:n,r=r?r+","+checkOptType(e[n]):checkOptType(e[n]);r="("+r+")"}return"("+t+") VALUES "+r}